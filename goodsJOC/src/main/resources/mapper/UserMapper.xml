<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="k5.goodsjoc.mapper.UserMapper">
	<resultMap type="User" id="userResultMap">
		<id column="levelNum" property="levelNum" />
		<result column="ID" property="ID" />
		<result column="PW" property="PW" />
		<result column="name" property="name" />
		<result column="birthday" property="birthday" />
		<result column="phone" property="phone" />
		<result column="email" property="email" />
		<result column="address" property="address" />
		<result column="martCode" property="martCode" />
		<result column="regDate" property="regDate" />
		
		<association javaType="Level" property="level">
			<id column="levelNum" property="levelNum" />
			<result column="levelName" property="levelName"/>
			<result column="note" property="note"/>
		</association>
	</resultMap>	



	<select id="getUserList" parameterType="String" resultMap="userResultMap">
		SELECT 
			u.ID				as id
			,u.PW				as pw
			,u.name
			,u.birthday
			,u.phone
			,u.email
			,u.address
			,u.martCode
			,u.levelNum
			,u.regDate
			,u.levelNum
			,l.levelName
		FROM 
			tb_user AS u
			INNER JOIN 
			tb_systemLevel AS l
			ON
			u.levelNum = l.levelNum
		WHERE
			martCode= #{martCode}
		ORDER BY
			u.levelNum ASC;
	</select>

	<select id="getUserInfoByID" parameterType="String" resultMap="userResultMap">
		SELECT 
			ID
			,PW
			,name
			,birthday
			,phone
			,email
			,address
			,martCode
			,levelNum
			,regDate
		FROM 
			tb_user
		WHERE 
			ID = #{ID};
	</select>
	
	<select id="getUserListBySearchKey" resultMap="userResultMap">		 
		SELECT 
			u.name, 
			u.birthday, 
			u.phone,
			u.email,
			u.address,
			u.martCode, 
			u.levelNum
		FROM 
			tb_user AS u
		<trim prefix="WHERE" prefixOverrides="AND|OR">
			<if test="searchValue != null and searchValue != ''.toString()">
				AND ${searchKey} LIKE CONCAT('%', #{searchValue}, '%');
			</if>
		</trim>
	</select>
	
	<update id="userUpdateInfo" parameterType="User">
      UPDATE tb_user      
      <trim prefix="SET" prefixOverrides=",">
         <if test="name != null and name != ''.toString()">
            ,name = #{name}
         </if>
         <if test="PW != null and PW != ''.toString()">
            ,PW = #{PW}
         </if>
         <if test="birthday != null and birthday != ''.toString()">
            ,birthday = #{birthday}
         </if>
         <if test="levelNum != null and levelNum != ''.toString()">
            ,levelNum = #{levelNum}
         </if>
         <if test="email != null and email != ''.toString()">
            ,email = #{email}
         </if>
         <if test="phone != null and phone != ''.toString()">
            ,phone = #{phone}
         </if>
         <if test="address != null and address != ''.toString()">
            ,address = #{address}
         </if>
      </trim>
      WHERE 
         ID=#{ID};
   </update>
	
	

</mapper>